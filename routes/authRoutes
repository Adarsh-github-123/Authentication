const express = require("express");
const bcrypt = require("bcrypt");
const {validateName, validateEmail, validatePassword } = require("../utils/validators");
const router = express.Router();

let users = {

}

router.post("/signUp", async (req, res) => {
    try{
        const {email, name, password} = req.body;
        
        const userExist = users.hasOwnProperty(email);

        if(userExist)
        {
            res.send("User Already Exists");
        }

        if(!validateName(name)){
            res.send("Invalid name");
        }

        if(!validateEmail(email)){
            res.send("Invalid email");
        }

        if(!validatePassword(password)){
            res.send("Invalid pasword")
        }

        const Epassword = await bcrypt.hash(password, 10);

        users[email] = { name, password: Epassword };
        res.send("Success");
        
    } catch(e){
        res.send("error");
    }
})

router.post("/signIn", async (req, res) => {
    try {
        const { email, password} = req.body;

        const userExist = users.hasOwnProperty(email);

        if(!userExist){
            res.send("User does not exist");
        }

        const passCheck = await bcrypt.compare(password, user[email].password);

        if(!passCheck){
            res.send("Password mismatch");
        }

        res.send("Success");

    } catch (e) {
        res.send("error");
    }
})

module.exports = router;